@page
@model ProiectWeb.Pages.Admin.Products.IndexModel
@{
    ViewData["Title"] = "Product List (Admin)";
}

<h2>Product List (Admin)</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success" id="success-message">
        @TempData["SuccessMessage"]
    </div>
}

<form id="searchForm" method="get" class="mb-3" onsubmit="return false;">
    <div class="input-group">
        <input type="text" id="searchInput" name="SearchString" value="@Model.SearchString" class="form-control" placeholder="Search products by name..." autocomplete="off" />
    </div>
</form>

<a asp-page="./Create" class="btn btn-primary mb-3">Add New Product</a>

<div id="productsList">
    @await Html.PartialAsync("_ProductListPartial", Model)
</div>

@section Scripts {
    <script>
        // Căutare live
        document.getElementById('searchInput').addEventListener('input', function () {
            const searchValue = this.value;
            fetch(`?handler=Search&searchString=${encodeURIComponent(searchValue)}`)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('productsList').innerHTML = html;
                })
                .catch(error => console.error('Error fetching search results:', error));
        });

        // Paginare
        function changePage(pageNumber) {
            fetch(`?handler=Page&pageNumber=${pageNumber}`)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('productsList').innerHTML = html;
                })
                .catch(error => console.error('Error changing page:', error));
        }
    </script>
}
